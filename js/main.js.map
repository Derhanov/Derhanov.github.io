{"version":3,"sources":["main.js"],"names":["touchHandler","e","touches","changedTouches","first","type","simulatedEvent","document","createEvent","initMouseEvent","window","screenX","screenY","clientX","clientY","target","dispatchEvent","preventDefault","init","addEventListener","DragManager","dragObject","self","onMouseDown","which","elem","closest","downX","pageX","downY","pageY","onMouseMove","avatar","moveX","moveY","Math","abs","createAvatar","coords","getCoords","shiftX","left","shiftY","top","startDrag","style","onMouseUp","finishDrag","dropElem","findDroppable","onDragCancel","onDragEnd","body","appendChild","zIndex","position","event","hidden","elementFromPoint","onmousemove","onmouseup","onmousedown","box","getBoundingClientRect","pageYOffset","pageXOffset"],"mappings":";;AAAA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,CAAC,YAAW;AACR,aAASA,YAAT,CAAsBC,CAAtB,EAAyB;AACrB,YAAIC,UAAUD,EAAEE,cAAhB;AACA,YAAIC,QAAQF,QAAQ,CAAR,CAAZ;AACA,YAAIG,OAAO,EAAX;;AAEA,gBAAQJ,EAAEI,IAAV;AACI,iBAAK,YAAL;AACIA,uBAAO,WAAP;AACA;AACJ,iBAAK,WAAL;AACIA,uBAAO,WAAP;AACA;AACJ,iBAAK,UAAL;AACIA,uBAAO,SAAP;AACA;AACJ;AACI;AAXR;;AAcI,YAAIC,iBAAiBC,SAASC,WAAT,CAAqB,YAArB,CAArB;AACAF,uBAAeG,cAAf,CAA8BJ,IAA9B,EAAoC,IAApC,EAA0C,IAA1C,EAAgDK,MAAhD,EAAwD,CAAxD,EAA2DN,MAAMO,OAAjE,EAA0EP,MAAMQ,OAAhF,EAAyFR,MAAMS,OAA/F,EAAwGT,MAAMU,OAA9G,EAAuH,KAAvH,EAA8H,KAA9H,EAAqI,KAArI,EAA4I,KAA5I,EAAmJ,CAAnJ,EAAsJ,IAAtJ;;AAEAV,cAAMW,MAAN,CAAaC,aAAb,CAA2BV,cAA3B;AACAL,UAAEgB,cAAF;AACH;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,aAASC,IAAT,GAAgB;AACZX,iBAASY,gBAAT,CAA0B,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","file":"main.js","sourcesContent":["// document.addEventListener('DOMContentLoaded', function () {\n\n\n// const boxList = document.getElementsByClassName('draggable');\n// boxList.onmousedown = function (e) {\n//     for(let i=0; i < boxList.length; i++) {\n//         let obj = boxList[i];\n//         const touch = event.targetTouches[0];\n//         event.target.style.left = touch.pageX + 'px';\n//         event.target.style.top = touch.pageY + 'px';\n//             event.preventDefault();\n//         }\n// }\n\n// const dragObj = {};\n//\n// document.onmousedown = function (e) {\n//     if (e.wich != 1) {\n//         return;\n//     }\n//     const elem = e.target.closest('.draggable');\n//     if (!elem) {\n//         return;\n//     }\n//     dragObj.elem = elem;\n//     dragObj.downX = e.pageX;\n//     dragObj.downY = e.pageY;\n// };\n//\n// document.onmousemove = function (e) {\n//     if(!dragObj.elem) return;\n//     if(!dragObj.avatar) {\n//         const moveX = e.pageX - dragObj.downX;\n//         const moveY = e.pageY - dragObj.downY;\n//         if ( Math.abs(moveX) < 3 && Math.abs(moveY) < 3 ) {\n//             return;\n//         }\n//         dragObj.avatar = createAvatar(e);\n//         if (!dragObject.avatar) {\n//             dragObject = {};\n//             return;\n//         }\n//         const coords = getCoords(dragObj.avatar);\n//         dragObj.shiftX = dragObj.downX -coords.left;\n//         dragObj.shiftY = dragObj.downY - coords.top;\n//\n//         startDrag(e);\n//     }\n//\n//     dragObj.avatar.style.left = e.pageX - dragObj.shiftX + 'px';\n//     dragObj.avatar.style.top = e.pageY - dragObj.shiftY + 'px';\n//\n//     return false;\n// };\n//\n// function createAvatar(e) {\n//\n//     // запомнить старые свойства, чтобы вернуться к ним при отмене переноса\n//     var avatar = dragObj.elem;\n//     var old = {\n//         parent: avatar.parentNode,\n//         nextSibling: avatar.nextSibling,\n//         position: avatar.position || '',\n//         left: avatar.left || '',\n//         top: avatar.top || '',\n//         zIndex: avatar.zIndex || ''\n//     };\n//\n//     // функция для отмены переноса\n//     avatar.rollback = function() {\n//         old.parent.insertBefore(avatar, old.nextSibling);\n//         avatar.style.position = old.position;\n//         avatar.style.left = old.left;\n//         avatar.style.top = old.top;\n//         avatar.style.zIndex = old.zIndex\n//     };\n//\n//     return avatar;\n// }\n//\n// function startDrag(e) {\n//     var avatar = dragObj.avatar;\n//\n//     document.body.appendChild(avatar);\n//     avatar.style.zIndex = 9999;\n//     avatar.style.position = 'absolute';\n// }\n\n// });\n\n// const bodyDoc = document.querySelector('body');\n// const div = document.createElement('DIV');\n// document.body.appendChild(div);\n// div.innerHTML = '<h1>Hello world</h1>';\n// console.log(bodyDoc);\n\n(function() {\n    function touchHandler(e) {\n        var touches = e.changedTouches;\n        var first = touches[0];\n        var type = \"\";\n\n        switch (e.type) {\n            case \"touchstart\":\n                type = \"mousedown\";\n                break;\n            case \"touchmove\":\n                type = \"mousemove\";\n                break;\n            case \"touchend\":\n                type = \"mouseup\";\n                break;\n            default:\n                return;\n        }\n\n            var simulatedEvent = document.createEvent(\"MouseEvent\");\n            simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY, false, false, false, false, 0, null);\n\n            first.target.dispatchEvent(simulatedEvent);\n            e.preventDefault();\n        }\n\n    //     var simulatedEvent = new MouseEvent(\"click\", {\n    //         view: window,\n    //         bubbles: true,\n    //         cancelable: true,\n    //         clientX: first.clientX,\n    //         clientY: first.clientY,\n    //         screenX: first.screenX,\n    //         screenY: first.screenY\n    // });\n    //     first.target.dispatchEvent(simulatedEvent);\n    //     console.log(simulatedEvent)\n    //\n    // }\n\n    function init() {\n        document.addEventListener(\"touchstart\", touchHandler, true);\n        document.addEventListener(\"touchmove\", touchHandler, true);\n        document.addEventListener(\"touchend\", touchHandler, true);\n        document.addEventListener(\"touchcancel\", touchHandler, true);\n    }\n\n    init();\n})();\n\n\n\n\nvar DragManager = new function() {\n\n    /**\n     * составной объект для хранения информации о переносе:\n     * {\n   *   elem - элемент, на котором была зажата мышь\n   *   avatar - аватар\n   *   downX/downY - координаты, на которых был mousedown\n   *   shiftX/shiftY - относительный сдвиг курсора от угла элемента\n   * }\n     */\n    var dragObject = {};\n\n    var self = this;\n\n    function onMouseDown(e) {\n\n        if (e.which != 1) return;\n\n        var elem = e.target.closest('.draggable');\n        if (!elem) return;\n\n        dragObject.elem = elem;\n\n        // запомним, что элемент нажат на текущих координатах pageX/pageY\n        dragObject.downX = e.pageX;\n        dragObject.downY = e.pageY;\n\n        return false;\n    }\n\n    function onMouseMove(e) {\n        if (!dragObject.elem) return; // элемент не зажат\n\n        if (!dragObject.avatar) { // если перенос не начат...\n            var moveX = e.pageX - dragObject.downX;\n            var moveY = e.pageY - dragObject.downY;\n\n            // если мышь передвинулась в нажатом состоянии недостаточно далеко\n            if (Math.abs(moveX) < 3 && Math.abs(moveY) < 3) {\n                return;\n            }\n\n            // начинаем перенос\n            dragObject.avatar = createAvatar(e); // создать аватар\n            if (!dragObject.avatar) { // отмена переноса, нельзя \"захватить\" за эту часть элемента\n                dragObject = {};\n                return;\n            }\n\n            // аватар создан успешно\n            // создать вспомогательные свойства shiftX/shiftY\n            var coords = getCoords(dragObject.avatar);\n            dragObject.shiftX = dragObject.downX - coords.left;\n            dragObject.shiftY = dragObject.downY - coords.top;\n\n            startDrag(e); // отобразить начало переноса\n        }\n\n        // отобразить перенос объекта при каждом движении мыши\n        dragObject.avatar.style.left = e.pageX - dragObject.shiftX + 'px';\n        dragObject.avatar.style.top = e.pageY - dragObject.shiftY + 'px';\n\n        return false;\n    }\n\n    function onMouseUp(e) {\n        if (dragObject.avatar) { // если перенос идет\n            finishDrag(e);\n        }\n\n        // перенос либо не начинался, либо завершился\n        // в любом случае очистим \"состояние переноса\" dragObject\n        dragObject = {};\n    }\n\n    function finishDrag(e) {\n        var dropElem = findDroppable(e);\n\n        if (!dropElem) {\n            self.onDragCancel(dragObject);\n        } else {\n            self.onDragEnd(dragObject, dropElem);\n        }\n    }\n\n    function createAvatar(e) {\n\n        // запомнить старые свойства, чтобы вернуться к ним при отмене переноса\n        var avatar = dragObject.elem;\n        // var old = {\n        //     parent: avatar.parentNode,\n        //     nextSibling: avatar.nextSibling,\n        //     position: avatar.position || '',\n        //     left: avatar.left || '',\n        //     top: avatar.top || '',\n        //     zIndex: avatar.zIndex || ''\n        // };\n        //\n        // // функция для отмены переноса\n        // avatar.rollback = function() {\n        //     old.parent.insertBefore(avatar, old.nextSibling);\n        //     avatar.style.position = old.position;\n        //     avatar.style.left = old.left;\n        //     avatar.style.top = old.top;\n        //     avatar.style.zIndex = old.zIndex\n        // };\n\n        return avatar;\n    }\n\n    function startDrag(e) {\n        var avatar = dragObject.avatar;\n\n        // инициировать начало переноса\n        document.body.appendChild(avatar);\n        avatar.style.zIndex = 9999;\n        avatar.style.position = 'absolute';\n    }\n\n    function findDroppable(event) {\n        // спрячем переносимый элемент\n        dragObject.avatar.hidden = true;\n\n        // получить самый вложенный элемент под курсором мыши\n        var elem = document.elementFromPoint(event.clientX, event.clientY);\n\n        // показать переносимый элемент обратно\n        dragObject.avatar.hidden = false;\n\n        if (elem == null) {\n            // такое возможно, если курсор мыши \"вылетел\" за границу окна\n            return null;\n        }\n\n        return elem.closest('.droppable');\n    }\n\n    document.onmousemove = onMouseMove;\n    document.onmouseup = onMouseUp;\n    document.onmousedown = onMouseDown;\n\n    this.onDragEnd = function(dragObject, dropElem) {};\n    this.onDragCancel = function(dragObject) {};\n\n};\n\n\nfunction getCoords(elem) { // кроме IE8-\n    var box = elem.getBoundingClientRect();\n\n    return {\n        top: box.top + pageYOffset,\n        left: box.left + pageXOffset\n    };\n\n}\n\n"]}