{"version":3,"sources":["main.js"],"names":["touchHandler","e","touches","changedTouches","first","type","simulatedEvent","MouseEvent","view","window","bubbles","cancelable","clientX","clientY","screenX","screenY","target","dispatchEvent","init","document","addEventListener","box","querySelectorAll","i","length","style","zIndex","DragManager","dragObject","self","onMouseDown","which","elem","closest","downX","pageX","downY","pageY","onMouseMove","avatar","moveX","moveY","Math","abs","createAvatar","coords","getCoords","shiftX","left","shiftY","top","startDrag","onMouseUp","finishDrag","dropElem","findDroppable","onDragCancel","onDragEnd","body","appendChild","position","event","elementFromPoint","onmousemove","onmouseup","onmousedown","getBoundingClientRect","pageYOffset","pageXOffset"],"mappings":"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","file":"main.js","sourcesContent":["\n(function() {\n    function touchHandler(e) {\n        const touches = e.changedTouches;\n        const first = touches[0];\n        let type = \"\";\n\n        switch (e.type) {\n            case \"touchstart\":\n                type = \"mousedown\";\n                break;\n            case \"touchmove\":\n                type = \"mousemove\";\n                break;\n            case \"touchend\":\n                type = \"mouseup\";\n                break;\n            default:\n                return;\n        }\n\n        //     var simulatedEvent = document.createEvent(\"MouseEvent\");\n        //     simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY, false, false, false, false, 0, null);\n        //\n        //     first.target.dispatchEvent(simulatedEvent);\n        //     e.preventDefault();\n        // }\n\n        // new method\n\n        var simulatedEvent = new MouseEvent(type, {\n            view: window,\n            bubbles: true,\n            cancelable: true,\n            clientX: first.clientX,\n            clientY: first.clientY,\n            screenX: first.screenX,\n            screenY: first.screenY\n        });\n        first.target.dispatchEvent(simulatedEvent);\n\n    }\n\n    function init() {\n        document.addEventListener(\"touchstart\", touchHandler, true);\n        document.addEventListener(\"touchmove\", touchHandler, true);\n        document.addEventListener(\"touchend\", touchHandler, true);\n        document.addEventListener(\"touchcancel\", touchHandler, true);\n    }\n\n    init();\n})();\n\n\nconst box = document.querySelectorAll('.draggable');\nfor (let i = 0; i < box.length; i++) {\n    box[i].addEventListener(\"mousedown\", function() {\n        this.style.zIndex = 1000;\n    }, true);\n\n    box[i].addEventListener(\"mouseleave\", function() {\n        this.style.zIndex = 0;\n    }, true);\n}\n\n\n\n\nvar DragManager = new function() {\n    var dragObject = {};\n    var self = this;\n\n    function onMouseDown(e) {\n\n        if (e.which != 1) return;\n\n        var elem = e.target.closest('.draggable');\n        if (!elem) return;\n        dragObject.elem = elem;\n\n        // dragObject.elem.style.zIndex = 100;\n        dragObject.downX = e.pageX;\n        dragObject.downY = e.pageY;\n        return false;\n    }\n\n\n    function onMouseMove(e) {\n        if (!dragObject.elem) return; // элемент не зажат\n\n        if (!dragObject.avatar) {\n            var moveX = e.pageX - dragObject.downX;\n            var moveY = e.pageY - dragObject.downY;\n\n            if (Math.abs(moveX) < 3 && Math.abs(moveY) < 3) {\n                return;\n            }\n\n            dragObject.avatar = createAvatar(e);\n            if (!dragObject.avatar) { // cancel drag\n                dragObject = {};\n                return;\n            }\n\n            var coords = getCoords(dragObject.avatar);\n            dragObject.shiftX = dragObject.downX - coords.left;\n            dragObject.shiftY = dragObject.downY - coords.top;\n            startDrag(e);\n        }\n\n        dragObject.avatar.style.left = e.pageX - dragObject.shiftX + 'px';\n        dragObject.avatar.style.top = e.pageY - dragObject.shiftY + 'px';\n\n        return false;\n    }\n\n    function onMouseUp(e) {\n        var elem = e.target.closest('.draggable');\n        if (!elem) return;\n        dragObject.elem = elem;\n        // dragObject.elem.style.zIndex = 100;\n\n        if (dragObject.avatar) {\n            finishDrag(e);\n        }\n        dragObject = {};\n    }\n\n    function finishDrag(e) {\n        var dropElem = findDroppable(e);\n\n        if (!dropElem) {\n            self.onDragCancel(dragObject);\n        } else {\n            self.onDragEnd(dragObject, dropElem);\n        }\n    }\n\n    function createAvatar(e) {\n        var avatar = dragObject.elem;\n        return avatar;\n    }\n\n    function startDrag(e) {\n        var avatar = dragObject.avatar;\n        document.body.appendChild(avatar);\n        avatar.style.zIndex = 1000;\n        avatar.style.position = 'absolute';\n    }\n\n    function findDroppable(event) {\n        // for obj\n        // dragObject.avatar.hidden = true;\n\n        // получить самый вложенный элемент под курсором мыши\n        var elem = document.elementFromPoint(event.clientX, event.clientY);\n\n        // display obj\n        // dragObject.avatar.hidden = false;\n\n        if (elem == null) {\n            return null;\n        }\n\n        return elem.closest('.droppable');\n    }\n\n    document.onmousemove = onMouseMove;\n    document.onmouseup = onMouseUp;\n    document.onmousedown = onMouseDown;\n\n    this.onDragEnd = function(dragObject, dropElem) {};\n    this.onDragCancel = function(dragObject) {};\n\n};\n\n\nfunction getCoords(elem) { // кроме IE8-\n    var box = elem.getBoundingClientRect();\n\n    return {\n        top: box.top + pageYOffset,\n        left: box.left + pageXOffset\n    };\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// document.getElementById('drag1').addEventListener('dragstart', function (e) {\n//     e.preventDefault();\n//     const img = document.createElement('IMG');\n//     img.src = 'img/6.png';\n    // e.dataTransfer.setDragImage(img, 0, 0);\n// }, false);\n"]}